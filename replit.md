# FluxCal - Realtime Metabolic Tracker

## Overview

FluxCal is a real-time metabolic tracking application that calculates calorie burn based on user-specific Basal Metabolic Rate (BMR) and Total Daily Energy Expenditure (TDEE). Users can log their biometric data (weight, height, age, gender, activity level) and track food intake throughout the day to monitor their caloric balance.

### Key Features
- **Week-based Navigation**: Users can navigate between days using a Mon-Sun pill interface with week navigation arrows. Days with logged food show indicator dots.
- **Food History**: Quick re-add of recently logged custom foods (max 10 items, localStorage-backed)
- **Edit/Delete Entries**: Each food entry has edit and delete buttons always visible for mobile-first UX
- **Fasting Tracker**: Visual timeline showing fasting stages (Fed → Post-Absorptive → Fat Burning → Deep Ketosis → Autophagy) with 2-week historical tracking and smooth Catmull-Rom interpolated line graphs
- **Goal Tracking**: Weight loss goals with daily calorie targets and progress visualization

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Routing**: Wouter (lightweight client-side router)
- **State Management**: TanStack React Query for server state and caching
- **UI Components**: Shadcn/ui component library built on Radix UI primitives
- **Styling**: Tailwind CSS with custom dark theme (luxury minimal design)
- **Animations**: Framer Motion for UI transitions
- **Fonts**: Inter for UI text, JetBrains Mono for numerical data display

### Backend Architecture
- **Runtime**: Node.js with Express.js
- **Language**: TypeScript (ESM modules)
- **API Pattern**: RESTful JSON API with `/api` prefix
- **Build Tool**: Vite for development, esbuild for production bundling

### Authentication
- **Provider**: Replit Auth via OpenID Connect (OIDC)
- **Login Options**: Google, GitHub, Apple, X, and email/password
- **Session Storage**: PostgreSQL-backed sessions (7-day TTL)
- **Auth Routes**: 
  - `/api/login` - Initiates OIDC login flow
  - `/api/callback` - OIDC callback handler
  - `/api/logout` - Ends session and redirects to Replit logout
  - `/api/auth/user` - Returns authenticated user data
- **Implementation**: `server/replitAuth.ts` handles OIDC setup, token refresh, and middleware
- **Required Secrets**: `SESSION_SECRET` (auto-generated by Replit)

### Data Layer
- **ORM**: Drizzle ORM with PostgreSQL dialect
- **Schema Location**: `shared/schema.ts` (shared between client and server)
- **Validation**: Zod schemas generated from Drizzle schemas via drizzle-zod
- **Database Tables**:
  - `sessions`: Stores user sessions for Replit Auth (required, do not drop)
  - `users`: Stores user profile from Replit Auth + biometric data (weight, height, age, gender, activity level) + goal tracking + fastingTrackingStartDate
  - `food_items`: Stores logged meals with calories, macros, and timestamps
  - `fasting_state_summaries`: Daily aggregates of time spent in each fasting state (Fed, Post-Absorptive, Fat Burning, Deep Ketosis, Autophagy) with 14-day retention

### Project Structure
```
├── client/           # React frontend
│   ├── src/
│   │   ├── components/ui/  # Shadcn component library
│   │   ├── pages/          # Route components
│   │   ├── hooks/          # Custom React hooks
│   │   └── lib/            # Utilities and query client
├── server/           # Express backend
│   ├── index.ts      # Server entry point
│   ├── routes.ts     # API route definitions
│   ├── storage.ts    # Database access layer
│   └── db.ts         # Database connection
├── shared/           # Shared code between client/server
│   └── schema.ts     # Drizzle schema definitions
└── migrations/       # Database migrations (Drizzle Kit)
```

### Development Workflow
- **Dev Server**: Vite dev server on port 5000 with HMR
- **API Proxy**: Express serves API routes, Vite handles frontend in development
- **Database Migrations**: Run `npm run db:push` to sync schema with database

## External Dependencies

### Database
- **PostgreSQL**: Primary database, connection via `DATABASE_URL` environment variable
- **postgres.js**: PostgreSQL client driver

### Third-Party Services
- None currently configured, but the build system includes bundling support for:
  - OpenAI API client
  - Google Generative AI
  - Stripe payments
  - Nodemailer for email

### Key NPM Packages
- `drizzle-orm` / `drizzle-kit`: Database ORM and migration tools
- `@tanstack/react-query`: Server state management
- `@radix-ui/*`: Accessible UI primitives
- `framer-motion`: Animation library
- `zod`: Runtime type validation